#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sat Jul 13 15:58:47 2024

@author: hpc
"""

import pandas as pd
import json

def json_to_csv(json_file, csv_file):
    # Read JSON file
    with open(json_file, 'r') as f:
        json_data = json.load(f)

    # Initialize empty lists for each feature
    features = {
        'accessedfiles': [],
        'apkname': [],
        'closenet': [],
        'cryptousage': [],
        'dataleaks': [],
        'dexclass': [],
        'enfperm': [],
        'fdaccess': [],
        'hashes': [],
        'opennet': [],
        'phonecalls': [],
        'recvnet': [],
        'recvsaction': [],
        'sendnet': []
    }

    # Extract data into respective lists
    for key, value in json_data.items():
        if key in features:
            if isinstance(value, dict):
                for k, v in value.items():
                    features[key].append({k: v})  # Append dictionary as-is
            elif isinstance(value, list):
                for item in value:
                    features[key].append(item)   # Append each list item as-is
            else:
                features[key].append(value)      # Append single value directly

    # Determine the maximum length of any list to pad shorter lists
    max_length = max(len(features[key]) for key in features)

    # Pad shorter lists with None to ensure equal length
    for key in features:
        if len(features[key]) < max_length:
            features[key] += [None] * (max_length - len(features[key]))

    # Convert to DataFrame
    df = pd.DataFrame(features)

    # Write DataFrame to CSV
    df.to_csv(csv_file, index=False)

# Example usage:
json_file = '/home/hpc/Desktop/apks/DroidBox_outputs/analysis_0a0d4826c33298fff22ca1323cac49fd.json' 
csv_file = '/home/hpc/Desktop/outputs.csv'

json_to_csv(json_file, csv_file)
